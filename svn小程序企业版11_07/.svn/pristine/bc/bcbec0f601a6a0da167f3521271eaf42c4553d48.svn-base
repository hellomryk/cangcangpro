// pages/jindu/jindu.js
var _this = null;
var timer1,timer2
Page({

  /**
   * 页面的初始数据
   */
  data: {
    loadnum:0,//显示百分比
    phototext:'',//显示文字
    src:'',//临时图片路径
    pagecan:21,//判断哪个页面过来的
    dmensionId: '',//用户选择的症状入口id
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    _this = this;
    console.log("onload")
    _this.setData({
      src:options.src,
      dmensionId: options.dmensionId
      // pagecan:options.pagecan,
    })
    var num = 0;
    timer1 = setInterval(function() { 
      if (num < 100) {
        num++;
        var loadnum = num;
        _this.setData({
          loadnum: loadnum
        })
        if (num == 3) {
          timer2 =  setInterval(function() {
              if(num < 32) {
                num++;
                var loadnum = num;
                _this.setData({
                  loadnum: loadnum
                })
              } else {
                clearInterval(timer2)
              }
            },30)
        }
        if (num == 35) {
          timer2 = setInterval(function () {
            if (num < 54) {
              num++;
              var loadnum = num;
              _this.setData({
                loadnum: loadnum
              })
            } else {
              clearInterval(timer2)
            }
          }, 10)
        }
        if (num == 55) {
          timer2 = setInterval(function () {
            if (num < 65) {
              num++;
              var loadnum = num;
              _this.setData({
                loadnum: loadnum
              })
            } else {
              clearInterval(timer2)
            }
          }, 50)
        }
        if (num == 67) {
          timer2 = setInterval(function () {
            if (num < 97) {
              num++;
              var loadnum = num;
              _this.setData({
                loadnum: loadnum
              })
            } else {
              clearInterval(timer2)
            }
          }, 50)
        }
        if (num >= 0 && num < 15) {
          _this.setData({
            phototext:'努力准备中，即将开始...'
          })
        } else if(num < 54) {
            _this.setData({
              phototext: '正常上传...'
            })
        } else if (num < 78) {
          _this.setData({
            phototext: '正在测量...'
          })
        } else if (num < 99) {
          _this.setData({
            phototext: '数据分析中...'
          })
        } else if (num >= 99) {
          _this.setData({
            phototext: '处理完毕，请选择症状。'
          })
        }
      } else {
        clearInterval(timer1)
        setTimeout(function () {
          wx.navigateTo({
            url: '/pages/znpz2/znpz2?src=' + _this.data.src+'&dmensionId=' + _this.data.dmensionId
          })
        }, 2000)
      }
    },1000*Math.random())
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {
    console.log("ready")
    _this.setData({
      pagecan:0
    })
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
    console.log("onshow")
    console.log(_this.data.pagecan)
    if (_this.data.pagecan == 0) {
      wx.navigateTo({
        url: '/pages/uploadimg/uploadimg'
      })
    }
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})